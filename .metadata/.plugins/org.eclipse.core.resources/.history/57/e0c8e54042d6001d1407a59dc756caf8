#pragma once

#include "Mini-STLIB/DataStructures/RingBuffer.hpp"
#include <stdint.h>
#include <cmath>

template<uint32_t BUFFER_SIZE, class BUFFER_TYPE>
class MovingAverage{
private:
	RingBuffer<BUFFER_SIZE, BUFFER_TYPE> ring;

public:
	double current_value;
	double add_value(BUFFER_TYPE value){
		BUFFER_TYPE old_value = ring.add_new_value(value);
		double temp_value = current_value;
		temp_value -= ((double) old_value) / BUFFER_SIZE;
		temp_value += ((double) value) / BUFFER_SIZE;
		if(temp_value != temp_value) // CHECK IF THE VALUE IS NAN
			int a = 0;
		current_value -= ((double) old_value) / BUFFER_SIZE;
		current_value += ((double) value) / BUFFER_SIZE;
		return current_value;
	}
};
